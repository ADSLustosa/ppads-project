{% extends 'base.html' %}
{% block title %}Criar Conta - Tiger Bank{% endblock %}
{% block content %}
<div class="card">
  <h2>üìù Criar Conta</h2>
  <form method="post">
    <div class="form-group">
      <label>Tipo de Pessoa</label>
      <div class="radio-group" id="person-type">
        <label><input type="radio" name="person_type" value="cpf" checked> Pessoa F√≠sica (CPF)</label>
        <label><input type="radio" name="person_type" value="cnpj"> Pessoa Jur√≠dica (CNPJ)</label>
      </div>
    </div>

    <div class="form-group">
      <label id="doc-label">CPF</label>
      <input type="text" id="doc-input" name="cpf" maxlength="14" placeholder="000.000.000-00" required>
    </div>

    <div class="form-group">
      <label>Nome</label>
      <input id="name" name="name" required placeholder="Digite seu nome completo">
    </div>

    <div class="form-group">
      <label>E-mail</label>
      <input type="email" id="email" name="email" required placeholder="seu@email.com">
    </div>

    <div class="form-group">
      <label>Senha</label>
      <input type="password" id="password" name="password" minlength="8" required placeholder="M√≠nimo 8 caracteres">
      <small id="pass-hint" class="muted"></small>
    </div>

    <div class="form-group">
      <label>Confirmar Senha</label>
      <input type="password" id="confirm" name="confirm" required>
    </div>

    <div class="form-group">
      <label>Tipo de Conta</label>
      <div class="radio-group">
        <label><input type="radio" name="acc_type" value="Corrente" checked> Conta Corrente</label>
        <label><input type="radio" name="acc_type" value="Poupan√ßa"> Conta Poupan√ßa</label>
      </div>
    </div>

    <button class="btn btn-success" type="submit">CRIAR CONTA</button>
    <a class="btn btn-secondary" href="{{ url_for('auth.home') }}">VOLTAR</a>
  </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const docInput = document.getElementById("doc-input");
  const docLabel = document.getElementById("doc-label");
  const radios = document.querySelectorAll('input[name="person_type"]');
  const nameField = document.getElementById("name");
  const emailField = document.getElementById("email");
  const passwordField = document.getElementById("password");
  const confirmField = document.getElementById("confirm");
  const hint = document.getElementById("pass-hint");

  // ======== M√ÅSCARAS CPF / CNPJ ========
  function formatCPF(value) {
    return value.replace(/\D/g, "")
      .replace(/(\d{3})(\d)/, "$1.$2")
      .replace(/(\d{3})(\d)/, "$1.$2")
      .replace(/(\d{3})(\d{1,2})$/, "$1-$2");
  }

  function formatCNPJ(value) {
    return value.replace(/\D/g, "")
      .replace(/(\d{2})(\d)/, "$1.$2")
      .replace(/(\d{3})(\d)/, "$1.$2")
      .replace(/(\d{3})(\d)/, "$1/$2")
      .replace(/(\d{4})(\d{1,2})$/, "$1-$2");
  }

  radios.forEach(radio => {
    radio.addEventListener("change", () => {
      if (radio.value === "cpf" && radio.checked) {
        docLabel.textContent = "CPF";
        docInput.name = "cpf";
        docInput.placeholder = "000.000.000-00";
        docInput.maxLength = 14;
        docInput.value = "";
      } else if (radio.value === "cnpj" && radio.checked) {
        docLabel.textContent = "CNPJ";
        docInput.name = "cnpj";
        docInput.placeholder = "00.000.000/0000-00";
        docInput.maxLength = 18;
        docInput.value = "";
      }
    });
  });

  docInput.addEventListener("input", (e) => {
    const type = document.querySelector('input[name="person_type"]:checked').value;
    e.target.value = type === "cpf" ? formatCPF(e.target.value) : formatCNPJ(e.target.value);
  });

  // ======== BLOQUEIO N√öMEROS EM NOME ========
  nameField.addEventListener("input", (e) => {
    e.target.value = e.target.value.replace(/[^a-zA-Z√Ä-√ø\s]/g, "");
  });

  // ======== E-MAIL FORMATA√á√ÉO AUTOM√ÅTICA ========
  emailField.addEventListener("blur", (e) => {
    e.target.value = e.target.value.trim().toLowerCase();
    e.target.value = e.target.value.trim().toLowerCase();
  });

  // ======== FOR√áA DE SENHA ========
  passwordField.addEventListener("input", (e) => {
    const val = e.target.value;
    const hasUpper = /[A-Z]/.test(val);
    const hasLower = /[a-z]/.test(val);
    const hasNum = /\d/.test(val);
    const strong = hasUpper && hasLower && hasNum && val.length >= 8;

    hint.textContent = strong
      ? "‚úîÔ∏è Senha forte"
      : "‚ö†Ô∏è Use letras mai√∫sculas, min√∫sculas e n√∫meros";
    hint.style.color = strong ? "#00d2d3" : "#f59e0b";
  });

  // ======== CONFIRMA√á√ÉO ========
  confirmField.addEventListener("input", () => {
    if (confirmField.value && confirmField.value !== passwordField.value) {
      confirmField.style.borderColor = "#e94560";
    } else {
      confirmField.style.borderColor = "";
    }
  });
});
</script>
{% endblock %}
